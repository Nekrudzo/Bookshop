(()=>{"use strict";const t=document.getElementById("point-list"),e=document.getElementById("slide-img-desktop"),n=document.querySelectorAll(".header__list a");n.forEach((t=>{t.addEventListener("click",(function(){n.forEach((t=>t.classList.remove("active"))),this.classList.add("active")}))})),document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelectorAll(".categories__item");t.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),t.forEach((t=>t.classList.remove("active"))),this.classList.add("active")}))}))}));const o=[{slideImgDesktop:"../Bookshop/src/images/slider/BlackFridaySale.png"},{slideImgDesktop:"../Bookshop/src/images/slider/OurCozyBooks.png"},{slideImgDesktop:"../Bookshop/src/images/slider/TopTenBooks.png"}];let s=0;const c=function(n){e.src=o[n].slideImgDesktop,t.children[s].children[0].src="../Bookshop/src/images/icons/icon_point_no-active.svg",t.children[n].children[0].src="../Bookshop/src/images/icons/icon_point_active.svg",s=n};t.addEventListener("click",(function(e){!function(t,e){let n=Array.from(e.children).findIndex((e=>e.children[0]===t.target));-1!==n&&n!==s&&c(n)}(e,t)})),setInterval((()=>{c((s+1)%o.length)}),5e3);const a=document.getElementById("books-list"),i=document.getElementById("btn-load");let r=0,l=6,d="",u=0;function g(){l=window.innerWidth<=768?3:6}async function m(){const t=await async function(t){const e=await fetch(`https://www.googleapis.com/books/v1/volumes?q=subject:${t}&startIndex=${r}&maxResults=${l}&key=AIzaSyBr5b1jgr_XXyYv4Fz3EnuKjkHSwLcGqXg`);return(await e.json()).items||[]}(d);0!==t.length?(t.forEach((t=>{const e=function(t){const e=document.createElement("div");e.classList.add("card"),e.id=`book-card-${u}`,u++;const n=t.volumeInfo.title,o=t.volumeInfo.authors?t.volumeInfo.authors.join(", "):"Не указано",s=t.volumeInfo.imageLinks?t.volumeInfo.imageLinks.thumbnail:"../Bookshop/src/images/noImage.jpg",c=t.volumeInfo.averageRating,a=t.volumeInfo.ratingsCount,i=t.volumeInfo.description||"Нет описания",r="FOR_SALE"===t.saleInfo.saleability&&t.saleInfo.listPrice?`${t.saleInfo.listPrice.amount} ${t.saleInfo.listPrice.currencyCode}`:"",l=document.createElement("button");return l.className="buy",l.id="buy",l.dataset.bookId=e.id,f.hasOwnProperty(e.id)?(l.innerText="In the list",l.setAttribute("data-in-cart","true")):(l.innerText="Buy now",l.setAttribute("data-in-cart","false")),e.innerHTML=`\n        <img src="${s}" alt="${n}" />\n        <div class="card-content">\n        <p>${o}</p>\n        <h3>${n}</h3>\n        ${c?`<p class="rating">${"★".repeat(Math.round(c))} (${a||0})</p>`:""}\n        <p class="description">${i}</p>\n        ${r?`<p class="price">${r}</p>`:""}\n        </div>\n    `,e.querySelector(".card-content").appendChild(l),e}(t);a.appendChild(e)})),r+=l):i.style.display="none"}window.addEventListener("resize",g),g(),i.addEventListener("click",m),document.querySelectorAll(".categories__item").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),d=this.dataset.category,a.innerHTML="",r=0,m(),document.querySelector(".categories__item.active").classList.remove("active"),this.classList.add("active")}))})),d="architecture",m();let p=0;const f={};function h(){const t=document.getElementById("carts-count");t.innerText=p>0?p:"0",localStorage.setItem("cartCount",p),p>0?t.innerText=p:(t.innerText="0",t.classList.add("circle"))}!function(){let t=localStorage.getItem("cartCount");p=isNaN(t)?0:parseInt(t);const e=JSON.parse(localStorage.getItem("bookButtons"))||{};Object.entries(e).forEach((([t,e])=>{e&&(f[t]=!0)})),h()}(),document.addEventListener("click",(function(t){if(t.target.classList.contains("buy")){const e=t.target,n=e.getAttribute("data-book-id"),o="true"===e.getAttribute("data-in-cart");console.log(`Clicked: ${n}, Currently in cart: ${o}, Current cart count: ${p}`),o?(e.innerText="Buy now",e.setAttribute("data-in-cart","false"),p-=1,delete f[n],function(t){const e=JSON.parse(localStorage.getItem("bookButtons"))||{};delete e[t],localStorage.setItem("bookButtons",JSON.stringify(e))}(n)):(e.innerText="In the list",e.setAttribute("data-in-cart","true"),p+=1,f[n]=!0),console.log(`Updated cart count: ${p}`),h(),localStorage.setItem("cartCount",p),localStorage.setItem("bookButtons",JSON.stringify(f))}})),console.log("Local Storage cartCount:",localStorage.getItem("cartCount")),console.log("Local Storage bookButtons:",localStorage.getItem("bookButtons"))})();